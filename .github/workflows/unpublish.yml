name: Unpublish Version
on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to unpublish'
        required: true
jobs:
  build:
    name: Unpublish Version
    env:
      NPM_CONFIG_@coremedia:registry: 'https://npm.coremedia.io'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Resolve NPM_AUTH_TOKEN
        run: |
          NPM_AUTH_TOKEN=$(curl -s -H "Accept: application/json" -H "Content-Type:application/json" -X PUT --data '{"name": "${{ secrets.CM_NPM_USER }}", "password": "${{ secrets.CM_NPM_PASSWORD }}"}' https://npm.coremedia.io/-/user/org.couchdb.user:${{ secrets.CM_NPM_USER }} | jq -r .token)
          echo "::add-mask::$NPM_AUTH_TOKEN"
          echo "NPM_CONFIG_//npm.coremedia.io/:_authToken=$NPM_AUTH_TOKEN" >> $GITHUB_ENV
          echo "NPM_AUTH_TOKEN=$NPM_AUTH_TOKEN" >> $GITHUB_ENV
          echo '//npm.coremedia.io/:_authToken=${NPM_AUTH_TOKEN}' > .npmrc
      - name: Unpublish release
        run: |
          version=${{ github.event.inputs.version }}
          npm unpublish @coremedia/ckeditor5-logging@$version
          npm unpublish @coremedia/ckeditor5-coremedia-studio-integration-mock@$version
          npm unpublish @coremedia/ckeditor5-coremedia-studio-integration@$version
          npm unpublish @coremedia/ckeditor5-studio-essentials@$version
          npm unpublish @coremedia/ckeditor5-coremedia-richtext@$version
          npm unpublish @coremedia/ckeditor5-dataprocessor-support@$version
          npm unpublish @coremedia/ckeditor5-coremedia-link@$version
          npm unpublish @coremedia/ckeditor5-symbol-on-paste-mapper@$version
          npm unpublish @coremedia/types-ckeditor__ckeditor5-editor-classic@$version
